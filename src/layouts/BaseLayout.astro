---
import "@/styles/global.css";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import SEO from "@/components/SEO.astro";
import { type SocialLink } from "@/lib/siteData";
import { loadSiteData } from "@/lib/siteData";

interface Props {
    subtitle?: string;
    description?: string;
    lang?: string;
    image?: string;
    socials?: SocialLink[];
}

const { subtitle, description, lang = "ja", image, socials = [] } = Astro.props;

const { site } = await loadSiteData(lang as any);
---

<!doctype html>
<html lang={lang} class="scroll-smooth">
    <head>
        <SEO
            title={subtitle ? `${subtitle} - ${site.title}` : site.title}
            description={description ?? site.description}
            lang={lang}
            image={image}
        />
        <!-- Google Fonts: Inter & Noto Sans JP -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&family=Merriweather:ital,wght@0,400;0,700;1,400&family=Space+Grotesk:wght@500;600;700&display=swap"
            rel="stylesheet"
        />
        <script is:inline>
            // テーマ初期化スクリプト: ページロード時のフラッシュを防ぐためにhead内に配置
            const theme = (() => {
                if (
                    typeof localStorage !== "undefined" &&
                    localStorage.getItem("theme")
                ) {
                    return localStorage.getItem("theme");
                }
                if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                    return "dark";
                }
                return "light";
            })();

            if (theme === "dark") {
                document.documentElement.classList.add("dark");
            } else {
                document.documentElement.classList.remove("dark");
            }
            window.localStorage.setItem("theme", theme);
        </script>
        <!-- MathJax Configuration -->
        <script is:inline>
            window.MathJax = {
                tex: {
                    inlineMath: [
                        ["\\(", "\\)"],
                        ["$", "$"],
                    ],
                    displayMath: [
                        ["\\[", "\\]"],
                        ["$$", "$$"],
                    ],
                    processEscapes: true,
                },
                options: {
                    ignoreHtmlClass: "tex2jax_ignore",
                    processHtmlClass: "tex2jax_process",
                },
            };
        </script>
        <script
            is:inline
            id="MathJax-script"
            async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"
        ></script>

        <!-- Highlight.js & Line Numbers -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
        />
        <script
            is:inline
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"
        ></script>
        <script
            is:inline
            src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"
        ></script>
        <script is:inline>
            document.addEventListener("DOMContentLoaded", () => {
                hljs.highlightAll();
                hljs.initLineNumbersOnLoad();
            });
        </script>
    </head>
    <body
        class="flex flex-col min-h-screen bg-bg text-fg transition-colors duration-300"
    >
        <Header lang={lang} title={site.title} />

        <!-- Main Content -->
        <main class="flex-1 w-full">
            <slot />
        </main>

        <Footer lang={lang} socials={socials} copyright={site.copyright} />
    </body>
</html>
